@extends('layouts.app')

@section('title', 'CVE一覧')

@section('content')

    @include('layouts.nav')

    <div class="container">
        @include('layouts.error_card_list')



        <div class="d-flex justify-content-end">
            <form class="form-inline d-flex float-right md-form form-sm mt-0" action="{{ route('vulnerability.index') }}">
                <i class="fas fa-search" aria-hidden="true"></i>
                <input class="form-control form-control-sm ml-3 w-75" type="text" placeholder="Search" aria-label="Search"
                    name="keyword" value="{{ empty(old()) ? $keyword : old('keyword') }}">
            </form>
        </div>

        <div class="d-flex justify-content-end">
            <a href="{{ route('vulnerability.create') }}"><button type="button"
                    class="btn btn-outline-primary btn-sm">CVE登録</button></a>
        </div>

        @if ($vulnerabilities->count())
            <div class="table-responsive-sm text-nowrap">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">CVE</th>
                            <th scope="col">Base Score</th>
                            <th scope="col">脆弱性の分類</th>
                            <th scope="col">概要</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach ($vulnerabilities as $vulnerability)
                            <tr>
                                <th scope="row">{{ $loop->iteration }}</th>
                                <td title="CVE詳細"><a
                                        href="{{ route('vulnerability.show', ['vulnerability' => $vulnerability->id]) }}">
                                        {{ $vulnerability->cve_id }}</a>
                                </td>
                                <td>
                                    <span class="base_score">{{ $vulnerability->base_score }}</span>
                                </td>
                                <td>
                                    {{ $vulnerability->cwe }}
                                </td>
                                <td>
                                    {!! nl2br(e(Str::limit($vulnerability->overview, 100))) !!}
                                </td>
                            </tr>
                        @endforeach
                    </tbody>
                </table>
            </div>
            <div class="container">
                <div class="row justify-content-center">
                    {{ $vulnerabilities->appends(request()->input())->links() }}
                </div>
            </div>
    </div>

@else

    <div class="card-text text-left alert alert-info">
        <ul class="mb-0">
            <li>Not Found</li>
        </ul>
    </div>

    @endif

    @if (isset($vulnerability))
        @include('javascript.index_base_score')
    @endif

@endsection
